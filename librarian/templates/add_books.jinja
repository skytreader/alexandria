{% extends "main.jinja" %}

{% macro render_creator_listing(creator_title) %}
{% set listing_label = "".join((creator_title.capitalize(), "(s):")) %}
<div class="grouped-input" id="{{ creator_title }}-block">
    <div class="row">
        <div class="col-md-11">
            <h3>{{ listing_label }}</h3>
        </div>
    </div>
    <div class="row">
        <div class="col-md-11">
            <div class="input-group">
                <input type="text" class="auto-lastname form-control single-liner-halves" placeholder="Last name" id="{{creator_title}}-proxy-lastname">
                <input type="text" class="auto-firstname form-control single-liner-halves" placeholder="First name" id="{{creator_title}}-proxy-firstname">
            </div>
        </div>
        <div class="col-md-1">
            <i class="fa fa-plus-circle fa-2x clickable" id="{{ creator_title }}-add"></i>
        </div>
    </div>
    <div class="row">
        <div class="col-md-11">
            <ul id="{{ creator_title }}-list" class="creator-name-list">
            </ul>
        </div>
    </div>
</div>
{% endmacro %}

{% block title %}Add Books{% endblock %}
{% block content %}
    <h1>Add Books</h1>
    <p></p>
    <!-- This is the hidden "buffer" form, the actual form mapped from back-end. -->
    <form method="POST" action="/add/books" role="form" id="main-form">
        {{ form.csrf_token }}
        {{ form.isbn() }}
        {{ form.title() }}
        {{ form.genre() }}
        {{ form.authors() }}
        {{ form.illustrators() }}
        {{ form.editors() }}
        {{ form.translators() }}
        {{ form.publisher() }}
        {{ form.printer() }}
        {{ form.year() }}
    </form>

    <!-- The proxy form, to be manipulated by JavaScript -->
    <form id="proxy-form">
        <h2>Book Information</h2>
        <div class="row">
            <div class="col-md-4">
                <label class="input-holder"><i class="fa fa-star"></i> ISBN:<br>
                <input type="text" id="isbn-proxy" class="form-control" name="isbn-rule">
                </label>
            </div>
            <div class="col-md-4">
                <label class="input-holder"><i class="fa fa-star"></i> Title:<br>
                <input type="text" id="title-proxy" class="form-control" name="title-rule">
                </label>
            </div>
            <div class="col-md-4">
                <label class="input-holder"><i class="fa fa-star"></i> Genre:<br>
                <input type="text" id="genre-proxy" class="form-control" name="genre-rule">
                </label>
            </div>
        </div>
        <div class="block">
            <h2>Content Creators</h2>
            {{ render_creator_listing("author") }}
            <br> 
            {{ render_creator_listing("illustrator") }}
            <br>
            {{ render_creator_listing("editor") }}
            <br>
            {{ render_creator_listing("translator") }}
        </div>
        <h2>Publishing Information</h2>
        <div class="row">
            <div class="col-md-4">
                <label class="input-holder"><i class="fa fa-star"></i> Publisher:<br>
                <input type="text" id="publisher-proxy" class="form-control" name="publisher-rule">
                </label>
            </div>
            <div class="col-md-4">
                <label class="input-holder">Printer:<br>
                <input type="text" id="printer-proxy" class="form-control">
                </label>
            </div>
            <div class="col-md-4">
                <label class="input-holder"><i class="fa fa-star"></i> Year:<br>
                <input type="text" id="year-proxy" class="form-control" name="year-rule">
                </label>
            </div>
        </div>
    </form>
    <div style="clear: both"></div>
    <div class="block">
        <br>
        <input type="button" class="btn btn-primary" value="Save Book" id="queue-book">
        <input type="button" class="btn btn-default" value="Clear Form" id="clear-proxy">
    </div>
    <hr>
    <h2>Books Entered</h2>
    <p>It may take some time to process all your books.</p>

    <div class="row">
        <div class="col-md-3">
            <div class="legend unsaved_book" id="unsaved-count">
            </div>
            Entered Books
        </div>
        <div class="col-md-3">
            <div class="legend saved_book" id="saved-count">
            </div>
            Saved
        </div>
        <div class="col-md-3">
            <div class="legend error_book" id="error-count">
            </div>
            Failed
        </div>
        <div class="col-md-3">
            <div class="legend reprocess_book" id="reprocessed-count">
            </div>
            Malformed
        </div>
    </div>

    <span id="qContainer">
    </span>
{% endblock %}
